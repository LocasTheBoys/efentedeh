-- Fungsi untuk mendapatkan paths dari script 1
local function getPaths()
    -- Menggunakan WaitForChild dengan timeout kecil untuk memastikan deteksi cepat
    local map = workspace:WaitForChild("Map", 5)
    if not map then return nil end

    local paths = map:WaitForChild("Paths", 5)
    if not paths then return nil end

    local path1 = paths:WaitForChild("1", 5)
    if not path1 then return nil end

    return path1
end

-- Konfigurasi Masang via path Koordinat
local waitTime = 1.5 -- Waktu tunggu minimal untuk memasang pet
local petName = "Funtime Foxy" -- Nama pet yang akan disummon

-- Fungsi teleportasi dan summon unit
local function teleportAndSummon(part1, part2)
    local player = game.Players.LocalPlayer
    local character = player.Character or player.CharacterAdded:Wait()
    
    if character and part1 and part2 then
        -- Teleportasi ke part1, part2, dan finalMidpoint
        character.HumanoidRootPart.CFrame = part1.CFrame
        wait(0.1)
        character.HumanoidRootPart.CFrame = part2.CFrame
        wait(0.1)

        local finalMidpoint = (part1.Position + part2.Position) / 2
        character.HumanoidRootPart.CFrame = CFrame.new(finalMidpoint)
        
        wait(waitTime) -- Tunggu sebelum summon

        -- Reset Settings
        game:GetService("ReplicatedStorage").Remotes.Misc.StopSettings:FireServer("Reset")
        for i = 1, 68 do
            game:GetService("ReplicatedStorage").Remotes.Misc.StopSettings:FireServer()
        end

        -- Summon unit
        local argsSummon = { [1] = petName, [2] = character.HumanoidRootPart.CFrame }
        game:GetService("ReplicatedStorage").Remotes.Towers.SummonTower:FireServer(unpack(argsSummon))
        print("Summoning unit:", petName, "at position", character.HumanoidRootPart.Position)
    else
        print("Teleportation failed: Part or Character missing.")
    end
end

-- Mendapatkan path untuk teleportasi segera setelah path terdeteksi
local path = getPaths()

if path then
    -- Menyiapkan bagian teleportasi
    local partList = {
        {path:WaitForChild("2", 5), path:WaitForChild("Start", 5)},
        {path:WaitForChild("1", 5), path:WaitForChild("3", 5)},
        {path:WaitForChild("3", 5), path:WaitForChild("Start", 5)}
    }

    -- Melakukan teleportasi dan summon pet di setiap bagian yang ditentukan
    for _, parts in ipairs(partList) do
        if parts[1] and parts[2] then
            teleportAndSummon(parts[1], parts[2])
        else
            print("Some parts are missing, skipping this teleportation.")
        end
    end
else
    print("Paths not detected. Please ensure the map and paths are loaded correctly.")
end
