-- Fungsi untuk mendapatkan paths dari script 1
local function getPaths()
    local map = workspace:FindFirstChild("Map")
    if not map then return nil end -- Pastikan Map ada

    local paths = map:FindFirstChild("Paths")
    if not paths then return nil end -- Pastikan Paths ada

    local path1 = paths:FindFirstChild("1")
    if not path1 then return nil end -- Pastikan Path 1 ada

    return path1
end

-- Konfigurasi Masang via path Koordinat
local waitTime = 1.5 -- Waktu tunggu minimal untuk memasang pet
local petName = "Funtime Foxy" -- Nama pet yang akan disummon

-- Fungsi teleportasi
local function teleportAndSummon(part1, part2)
    local player = game.Players.LocalPlayer
    local character = player.Character or player.CharacterAdded:Wait()

    -- Loop teleportasi dua kali untuk memastikan perpindahan
    for i = 1, 2 do
        character.HumanoidRootPart.CFrame = part1.CFrame
        wait(0.1) -- Tunggu sejenak untuk memastikan posisi
        character.HumanoidRootPart.CFrame = part2.CFrame
        wait(0.1)
    end

    -- Menentukan midpoint antara part1 dan part2, lalu memindahkan karakter ke midpoint tersebut
    local finalMidpoint = (part1.Position + part2.Position) / 2
    character.HumanoidRootPart.CFrame = CFrame.new(finalMidpoint)

    -- Waktu tunggu setelah teleportasi sebelum summon pet
    wait(waitTime)

    -- Mengirim sinyal "Reset" untuk StopSettings
    local argsReset = { [1] = "Reset" }
    game:GetService("ReplicatedStorage").Remotes.Misc.StopSettings:FireServer(unpack(argsReset))

    -- Mengirim sinyal StopSettings berulang kali
    for i = 1, 68 do
        game:GetService("ReplicatedStorage").Remotes.Misc.StopSettings:FireServer()
    end

    -- Mengambil CFrame dari HumanoidRootPart pemain untuk summoning
    local humanoidRootPartCFrame = character.HumanoidRootPart.CFrame

    -- Mengirim sinyal untuk summon tower dengan pet yang sudah dikonfigurasi
    local argsSummon = { [1] = petName, [2] = humanoidRootPartCFrame }
    game:GetService("ReplicatedStorage").Remotes.Towers.SummonTower:FireServer(unpack(argsSummon))
end

-- Loop menunggu hingga path terdeteksi
local pathsFound = false

while not pathsFound do
    local path = getPaths()
    if path then
        pathsFound = true -- Jika path ditemukan, flag menjadi true

        -- Menyiapkan bagian untuk teleportasi
        local partList = {
            {path:FindFirstChild("2"), path:FindFirstChild("Start")},
            {path:FindFirstChild("1"), path:FindFirstChild("3")},
            {path:FindFirstChild("3"), path:FindFirstChild("Start")}
        }

        -- Melakukan teleportasi dan summon pet di setiap bagian yang ditentukan
        for _, parts in ipairs(partList) do
            if parts[1] and parts[2] then -- Pastikan part ada sebelum teleportasi
                teleportAndSummon(parts[1], parts[2])
            else
                print("Some parts are missing in path, skipping teleportation for this set.")
            end
        end
    else
        print("Waiting for paths to be detected...") -- Jika path belum ditemukan
    end

    wait(1) -- Tunggu 1 detik sebelum memeriksa lagi
end
